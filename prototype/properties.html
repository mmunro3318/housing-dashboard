<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Properties - Housing Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .nav-link.active {
            background-color: #1e40af;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold">Housing Dashboard</h1>
                    <p class="text-blue-200 text-sm">Halfway Housing Management System</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm">Welcome, Manager</span>
                    <button class="bg-blue-700 hover:bg-blue-800 px-4 py-2 rounded text-sm">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-md">
        <div class="container mx-auto px-6">
            <div class="flex space-x-1">
                <a href="index.html" class="nav-link px-6 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100">Dashboard</a>
                <a href="properties.html" class="nav-link active px-6 py-3 text-sm font-medium">Properties</a>
                <a href="tenants.html" class="nav-link px-6 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100">Tenants</a>
                <a href="intake-form.html" class="nav-link px-6 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100">Intake Form</a>
                <a href="reports.html" class="nav-link px-6 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100">Reports</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Page Header -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Properties & Beds</h1>
                <p class="text-gray-600 mt-1">Manage your housing properties and bed assignments</p>
            </div>
            <button class="mt-4 md:mt-0 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-medium">
                + Add New Property
            </button>
        </div>

        <!-- Properties List -->
        <div id="properties-list" class="space-y-6">
            <!-- Properties loaded by JavaScript -->
        </div>
    </main>

    <script src="js/data.js"></script>
    <script>
        function loadProperties() {
            const container = document.getElementById('properties-list');

            dashboardData.houses.forEach(house => {
                const houseBeds = dashboardData.beds.filter(b => b.house_id === house.house_id);
                const occupied = houseBeds.filter(b => b.status === 'Occupied').length;
                const available = houseBeds.filter(b => b.status === 'Available').length;
                const pending = houseBeds.filter(b => b.status === 'Pending').length;
                const occupancy = ((occupied / houseBeds.length) * 100).toFixed(1);

                const propertyCard = document.createElement('div');
                propertyCard.className = 'bg-white rounded-lg shadow-md overflow-hidden';
                propertyCard.innerHTML = `
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">${house.address}</h2>
                                ${house.notes ? `<p class="text-sm text-gray-600 mt-1">${house.notes}</p>` : ''}
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500">Occupancy</p>
                                <p class="text-2xl font-bold text-purple-600">${occupancy}%</p>
                            </div>
                        </div>

                        <!-- Stats -->
                        <div class="grid grid-cols-4 gap-4 mt-4">
                            <div class="text-center">
                                <p class="text-2xl font-bold text-gray-800">${houseBeds.length}</p>
                                <p class="text-xs text-gray-500">Total Beds</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-green-600">${occupied}</p>
                                <p class="text-xs text-gray-500">Occupied</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-blue-600">${available}</p>
                                <p class="text-xs text-gray-500">Available</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-yellow-600">${pending}</p>
                                <p class="text-xs text-gray-500">Pending</p>
                            </div>
                        </div>
                    </div>

                    <!-- Beds Grid -->
                    <div class="p-6">
                        <h3 class="font-semibold text-gray-700 mb-3">Bed Status</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3" id="beds-${house.house_id}">
                            <!-- Beds loaded below -->
                        </div>
                    </div>
                `;

                container.appendChild(propertyCard);

                // Load beds for this property
                const bedsContainer = document.getElementById(`beds-${house.house_id}`);
                houseBeds.forEach(bed => {
                    const tenant = bed.tenant_id ? dashboardData.tenants.find(t => t.tenant_id === bed.tenant_id) : null;

                    const statusColors = {
                        'Available': 'bg-green-100 border-green-300 text-green-800',
                        'Occupied': 'bg-gray-100 border-gray-300 text-gray-800',
                        'Pending': 'bg-yellow-100 border-yellow-300 text-yellow-800',
                        'Hold': 'bg-red-100 border-red-300 text-red-800'
                    };

                    const bedCard = document.createElement('div');
                    bedCard.className = `border-2 rounded-md p-3 cursor-pointer hover:shadow-md transition ${statusColors[bed.status]}`;
                    bedCard.innerHTML = `
                        <p class="font-semibold text-xs">${bed.room_number}</p>
                        <p class="text-xs mt-1">${bed.status}</p>
                        ${tenant ? `<p class="text-xs mt-1 font-medium truncate" title="${tenant.full_name}">${tenant.full_name}</p>` : ''}
                    `;

                    bedCard.addEventListener('click', () => {
                        if (tenant) {
                            alert(`Tenant: ${tenant.full_name}\nDOC: ${tenant.doc_number}\nPayment: ${tenant.payment_type}\nRent Due: $${tenant.rent_due}\nRent Paid: $${tenant.rent_paid}`);
                        } else {
                            alert(`${bed.room_number} is ${bed.status.toLowerCase()}`);
                        }
                    });

                    bedsContainer.appendChild(bedCard);
                });
            });
        }

        loadProperties();
    </script>
</body>
</html>
